sudo: required
language: cpp
arch:
  packages:
  - llvm
  - clang
  - cmake
  - boost
  - python-pip
  - kf5
  - fuse2
  - extra-cmake-modules
  - wget
  script:
  - sudo pip install git+git://github.com/eddyxu/cpp-coveralls.git
  - mkdir testbuild && cd testbuild && cmake .. -DCMAKE_CXX_FLAGS="-fprofile-arcs
    -ftest-coverage -std=c++11 -lstdc++" && make &&  CTEST_OUTPUT_ON_FAILURE=1 make
    test &&  coveralls --exclude /usr/ --exclude ../test/ --exclude ../third_party
    --exclude ../libchig/include/chig/json.hpp --include ../libchig/ --include ../chig/
  - mkdir build
  - wget https://github.com/probonopd/linuxdeployqt/releases/download/2/linuxdeployqt-2-x86_64.AppImage
  - chmod a+x ./linuxdeployqt-2-x86_64.AppImage
  - 'cd build && cmake .. -DCMAKE_BUILD_TYPE=Release && make && LD_LIBRARY_PATH=`pwd`/lib:`pwd`/libchig
    ../linuxdeployqt-2-x86_64.AppImage gui/chiggui -appimage '
  - sudo cp build/Application-x86_64.AppImage Chigraph-x86_64-$(git describe --tags
    --always).AppImage
script:
- curl -s https://raw.githubusercontent.com/mikkeloscar/arch-travis/master/arch-travis.sh
  | bash

deploy:
  provider: releases
  api_key:
    secure: YihGytt5BxAEKxSuj9SqcMbMSOBMQpdsmQBNsOQnx0PopxFj73q+Nx9AMqC06TdXerK22D+PXubxCKjqtjf1OCeVaG5X+WGsaMBVt02isMpcQjxRzvTORpIQ+AsTFAq2eFALfVSFHqjwiom2esCcm/2hPN4i5v1wti9OSL11tjAD/gyfthK3NDEgY/ccb+69C3sdJu0QcSTSwEjAWOIsP2KSFsMDghyVUia07+tVtisaF6NR6mClCXkeSI5zTlAt7Nd8LzUGvhUWs+TKf4UIdLKgEH2NtwQjR9chkNsT6xMpfErz6Wx7Uawb377ASYA9w7b3gW/Xqo/mDClPc5Y0DKQhKzp1EZesrpNambI/O7Sr/b7tbJm4Bu3W0wfpfwyrxSYjUOTST1Gu0OjszT33yWymSzLu1v32Na4DRo8YR6hmH0SjBBPwbRt5AQQSdiMbfHdpUHkNOyqLqlE/YTJkvzHKoY4TUSqMR1xVUZBFdFXmAgoXzR3SxZ0k2rGyWZ9Y5xNBD5ZSQ0R/cY7KKQ2Ctv0e9bW2Z5L5kNXkUeRiZa/MKoydNqVeOjkiV2fRb2HEOBS2s8FPk8tAFFyp+fCh6h2gCQhM5X22wSmQVk08IqogmD9bh6MM/zqNkJ2FTCJMpR0LpctbalVo2cFZgh1cbSM0YMg7y5xIV9ToyK2asrA=
  file: Chigraph-x86_64-$(git describe --tags --always).AppImage
  on:
    repo: russelltg/chigraph
